// Structured Output Example
// Demonstrates: struct declarations, output field, typed responses

// ============================================
// Struct Definitions
// ============================================

struct Classification {
    category: string
    confidence: number
    reasoning: string
}

struct ExtractedData {
    name: string
    email: string
    company: string
    role: string
}

struct SentimentAnalysis {
    sentiment: string
    score: number
    keywords: string[]
}

struct MeetingDetails {
    date: string
    time: string
    attendees: string[]
    agenda: string[]
    location: string
}

struct IssueClassification {
    type: string
    confidence: number
}

// ============================================
// Agents with Structured Output
// ============================================

// Classifier returns typed classification data
agent EmailClassifier {
    systemPrompt: "You are an email classifier. Classify emails into categories:
- inquiry: questions about products/services
- support: technical issues or complaints
- sales: purchase requests or negotiations
- spam: unwanted or promotional content

Analyze the email and return your classification with confidence (0-1) and reasoning."
    model: "gpt-4o-mini"
    output: Classification
}

// Extractor pulls structured data from text
agent ContactExtractor {
    systemPrompt: "You are a contact information extractor. Extract the following from the provided text:
- name: person's full name
- email: email address
- company: organization name
- role: job title or position

If any field is not found, use 'unknown'."
    model: "gpt-4o-mini"
    output: ExtractedData
}

// Analyzer with named output type
agent SentimentAnalyzer {
    systemPrompt: "Analyze the sentiment of the given text. Return:
- sentiment: 'positive', 'negative', or 'neutral'
- score: -1.0 (very negative) to 1.0 (very positive)
- keywords: list of words that influenced your analysis"
    model: "gpt-4o-mini"
    output: SentimentAnalysis
}

// Agent with multi-line inline output type
agent MeetingExtractor {
    systemPrompt: "Extract meeting details from the text. Find the date, time, attendees, and agenda items."
    model: "gpt-4o-mini"
    output: {
        date: string
        time: string
        attendees: string[]
        agenda: string[]
        location: string
    }
}

// Agent with retries configured and inline output
agent StrictClassifier {
    systemPrompt: "Classify the input into exactly one of: bug, feature, question, documentation. Be precise."
    model: "gpt-4o"
    output: { type: string, confidence: number }
    outputRetries: 3
}

// ============================================
// Example Runs
// ============================================

let email_result = EmailClassifier.userPrompt("Hi, I've been having trouble logging into my account for the past 3 days. I've tried resetting my password but it still doesn't work. Can someone please help? - John").run()

let contact_result = ContactExtractor.userPrompt("Please reach out to Sarah Johnson at sarah.j@techcorp.io. She's the Head of Engineering at TechCorp and would be the right person to discuss the integration.").run()

let sentiment_result = SentimentAnalyzer.userPrompt("I absolutely love this product! It has completely transformed how our team works. The customer support is also fantastic - they responded within minutes.").run()
